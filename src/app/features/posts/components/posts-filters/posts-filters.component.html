<main class="container">
  <div class="left-section w-100">
    <ng-content select="[left-section-element]"></ng-content>

    <div class="filters-card rounded-card">
      <button class="filters-card__button rounded-button-slim" (click)="showFilters = !isDesktop ? !showFilters : true">
        <span>Filtros y b√∫squeda</span>
        <mat-icon class="small-icon">
          {{ showFilters && !isDesktop ? 'expand_less' : 'filter_alt' }}
        </mat-icon>
      </button>
      <div class="filters-card__content" *ngIf="showFilters" @inOutY [@.disabled]="isDesktop">
        <!-- Searchbar -->
        <div class="rounded-search-bar">
          <input type="search" [formControl]="searchControl" placeholder="Buscar"
            (keyup.enter)="doSearch(1); updateHasFilters()">
          <button *ngIf="!!postFilters.search && postFilters.search === searchControl.value" mat-icon-button
            (click)="clearSearchControl()" matTooltip="Borrar">
            <mat-icon>close</mat-icon>
          </button>
          <button *ngIf="!!!postFilters.search || postFilters.search !== searchControl.value" mat-icon-button
            (click)="doSearch(1)" matTooltip="Buscar">
            <mat-icon>search</mat-icon>
          </button>
        </div>

        <mat-divider></mat-divider>

        <!-- Filters -->
        <div class="filters__selects">
          <app-rounded-select class="bg-text-academic-level" baseText="Nivel Acad√©mico" [control]="academicLevelControl"
            [options]="academicLevels" [resetButton]="true" [loading]="isAcademicLevelsLoading">
          </app-rounded-select>
          <app-rounded-select class="bg-text-axis" baseText="Eje" [control]="axisControl" [hasGroups]="true"
            [options]="axesGroup" [searchInput]="true" searchPlaceholder="Busca un eje o asignatura"
            [resetButton]="true" [loading]="isAxesLoading">
          </app-rounded-select>
          <app-rounded-select class="bg-text-subject" baseText="Asignatura" [control]="subjectControl"
            [options]="subjects" [searchInput]="true" searchPlaceholder="Busca una asignatura" [resetButton]="true"
            [loading]="isSubjectsLoading">
          </app-rounded-select>
          <app-rounded-select class="bg-text-blue-white" baseText="Ordenar por" [control]="orderingControl"
            [options]="orderingList">
          </app-rounded-select>
        </div>
        <button class="reset-filters-button" *ngIf="hasFilters" (click)="removeFilters()" matRipple @inOutY>
          <mat-icon class="small-icon">delete</mat-icon>
          <span class="fw-600">Borrar filtros</span>
        </button>
      </div>
    </div>
  </div>

  <div class="main-content">
    <!-- Filter tags and pagination -->
    <div class="fs-small flex-end-center flex-wrap gap-05">
      <!-- Filter tags -->
      <div class="filter-tags flex-center-center gap-025 flex-wrap">
        <button *ngIf="!!postFilters.search && !!searchControl.value" @inOutLeft (click)="removeFilter('search')"
          matRipple class="rounded-button-slim">
          <mat-icon class="small-icon">search</mat-icon>
          <span>{{ postFilters.search|truncate:20 }}</span>
          <mat-icon class="small-icon" matTooltip="Remover">close</mat-icon>
        </button>
        <button *ngIf="!!academicLevelControl.value" @inOutLeft (click)="removeFilter('academicLevel')" matRipple
          class="rounded-button-slim bg-text-academic-level">
          <span>{{ academicLevelControl.value.data.name }}</span>
          <mat-icon class="small-icon" matTooltip="Remover">close</mat-icon>
        </button>
        <button *ngIf="!!axisControl.value" @inOutLeft (click)="removeFilter('axis')" matRipple
          class="rounded-button-slim bg-text-axis">
          <span>{{ axisControl.value.data.name }}</span>
          <mat-icon class="small-icon" matTooltip="Remover">close</mat-icon>
        </button>
        <button *ngIf="!!subjectControl.value" @inOutLeft (click)="removeFilter('subject')" matRipple
          class="rounded-button-slim bg-text-subject">
          <span>{{ subjectControl.value.data.name }}</span>
          <mat-icon class="small-icon" matTooltip="Remover">close</mat-icon>
        </button>
        <button *ngIf="!!orderingControl.value && orderingControl.value.data.id !== orderingType.MOST_RECENT" @inOutLeft
          (click)="removeFilter('ordering')" matRipple class="rounded-button-slim bg-text-blue-white">
          <mat-icon class="small-icon">sort</mat-icon>
          <span>{{ orderingControl.value.data.name }}</span>
          <mat-icon class="small-icon" matTooltip="Remover">close</mat-icon>
        </button>
      </div>

      <!-- Pagination -->
      <div class="pagination flex-center-center gap-05">
        <span class="fw-700 fs-regular" *ngIf="!isLoading && !!posts.length" @inOutRight>
          {{ pageResults?.count }} resultados
        </span>
        <div class="flex-center-center gap-025">
          <button class="circle-button" (click)="previousPage()" [disabled]="!pageResults?.previous || isLoading"
            aria-label="P√°g. Anterior" matTooltip="P√°g. Anterior" matRipple>
            <mat-icon class="small-icon">navigate_before</mat-icon>
          </button>
          <button class="circle-button fs-medium" [matMenuTriggerFor]="pagesMenu" aria-label="Seleccionar p√°gina"
            matTooltip="Seleccionar p√°gina" matRipple [disabled]="isLoading || !posts.length">
            <span class="fs-small fw-700">{{ postFilters.page }}</span>
          </button>
          <mat-menu #pagesMenu>
            <button mat-menu-item *ngFor="let page of (pageResults?.maxPage ?? 1)|fillArray" (click)="doSearch(page)">
              {{ page }}
            </button>
          </mat-menu>
          <button class="circle-button" (click)="nextPage()" [disabled]="!pageResults?.next || isLoading"
            aria-label="P√°g. Siguiente" matTooltip="P√°g. Siguiente" matRipple>
            <mat-icon class="small-icon">navigate_next</mat-icon>
          </button>
        </div>
      </div>
    </div>

    <!-- Post grid -->
    <section class="posts-grid" *ngIf="!isLoading && posts.length" @fadeInOut>
      <ng-container *ngFor="let post of posts">
        <app-post-card [post]="post" [urlQueryParams]="urlQueryParams" [isOwner]="authUser?.id === post.user.id"
          (report)="report(post)" (delete)="deletePost(post)"></app-post-card>
      </ng-container>
    </section>

    <!-- Post shimmer grid -->
    <div class="posts-grid" *ngIf="isLoading" @fadeInOut>
      <app-post-card-shimmer *ngFor="let post of 6|fillArray"></app-post-card-shimmer>
    </div>

    <!-- No results -->
    <div class="flex-column flex-center-center text-center gap-05 m-t-2" *ngIf="!isLoading && !posts.length" @fadeInOut>
      <img class="no-results-image" src="assets/images/no-results.png" alt="Perdido en el espacio">
      <p class="fs-medium fw-700">No se han encontrado resultados</p>
      <p class="fw-700">A√∫n nadie ha creado una publicaci√≥n con tus par√°metros de b√∫squeda üòÖ</p>
    </div>
  </div>
</main>