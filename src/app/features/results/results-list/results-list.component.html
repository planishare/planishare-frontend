<main class="container">
  <div class="filters-card rounded-card">
    <button
      class="filters-card__button rounded-button-slim"
      (click)="showFilterCardContent = !isDesktop ? !showFilterCardContent : true">
        <span>Filtros y búsqueda</span>
        <mat-icon class="small-icon">
          {{ showFilterCardContent && !isDesktop ? 'expand_less' : 'filter_alt' }}
        </mat-icon>
    </button>
    <div class="filters-card__content" *ngIf="showFilterCardContent">
      <!-- Searchbar -->
      <div class="rounded-search-bar box-shadow-2">
        <input type="search" [formControl]="searchControl" placeholder="Buscar" (keyup.enter)="doSearch(1)">
        <button *ngIf="!!postFilters.search && postFilters.search === searchControl.value" mat-icon-button (click)="clearSearchControl()">
          <mat-icon>close</mat-icon>
        </button>
        <button *ngIf="!!!postFilters.search || postFilters.search !== searchControl.value" mat-icon-button (click)="doSearch(1)">
          <mat-icon>search</mat-icon>
        </button>
      </div>
  
      <mat-divider></mat-divider>
    
      <!-- Filters -->
      <div class="filters__selects">
        <app-rounded-select
          class="bg-text-academic-level box-shadow-2"
          baseText="Nivel Académico"
          [control]="academicLevelControl"
          [options]="academicLevelsList"
          [resetButton]="true"
          [loading]="isAcademicLevelsLoading">
        </app-rounded-select>
        <app-rounded-select
          class="bg-text-axis box-shadow-2"
          baseText="Eje"
          [control]="axisControl"
          [hasGroups]="true"
          [options]="subjectWithAxis"
          [searchInput]="true"
          searchPlaceholder="Busca un eje o asignatura"
          [resetButton]="true"
          [loading]="isAxesLoading">
        </app-rounded-select>
        <app-rounded-select
          class="bg-text-subject box-shadow-2"
          baseText="Asignatura"
          [control]="subjectControl"
          [options]="subjectList"
          [searchInput]="true"
          searchPlaceholder="Busca una asignatura"
          [resetButton]="true"
          [loading]="isSubjectsLoading">
        </app-rounded-select>
        <app-rounded-select
          class="bg-text-blue-white box-shadow-2"
          baseText="Ordenar por"
          [control]="orderingControl"
          [options]="orderingList">
        </app-rounded-select>
    
        <button class="reset-filters-button" *ngIf="hasFilters" (click)="removeFilters()">
          <mat-icon class="small-icon">delete</mat-icon>
          <span class="fw-600">Borrar filtros</span>
        </button>
      </div>
    </div>
  </div>
  
  <div class="main-content">
    <!-- Filter tags and pagination -->
    <div class="fs-small flex-end-center flex-wrap gap-05">
      <!-- Filter tags -->
      <div class="filter-tags flex-center-center gap-025 flex-wrap">
        <button
          *ngIf="!!academicLevelControl.value"
          (click)="removeFilter('academicLevel')"
          class="rounded-button-slim bg-text-academic-level box-shadow-1">
            <span>{{ academicLevelControl.value.data.name }}</span>
            <mat-icon class="small-icon">close</mat-icon>
        </button>
        <button
          *ngIf="!!axisControl.value"
          (click)="removeFilter('axis')"
          class="rounded-button-slim bg-text-axis box-shadow-1">
            <span>{{ axisControl.value.data.name }}</span>
            <mat-icon class="small-icon">close</mat-icon>
        </button>
        <button
          *ngIf="!!subjectControl.value"
          (click)="removeFilter('subject')"
          class="rounded-button-slim bg-text-subject box-shadow-1">
            <span>{{ subjectControl.value.data.name }}</span>
            <mat-icon class="small-icon">close</mat-icon>
        </button>
        <button
          *ngIf="!!orderingControl.value && orderingControl.value.data.id !== orderingType.MOST_RECENT"
          (click)="removeFilter('ordering')"
          class="rounded-button-slim bg-text-blue-white box-shadow-1">
            <span>{{ orderingControl.value.data.name }}</span>
            <mat-icon class="small-icon">close</mat-icon>
        </button>
      </div>
    
      <!-- Pagination -->
      <div class="pagination flex-center-center gap-05">
        <span class="fw-700 fs-regular">
          {{ (pageInfo?.maxPage ?? 0) * (postFilters.page! - 1) + 1 }}
           - {{ (pageInfo?.maxPage ?? 0) * (postFilters.page! - 1) + posts.length }}
          de {{ pageInfo?.count }}
        </span>
        <div class="flex-center-center gap-025">
          <button class="circle-button" (click)="previousPage()" [disabled]="!pageInfo?.previous || isLoading">
            <mat-icon class="small-icon">navigate_before</mat-icon>
          </button>
          <button class="circle-button" [matMenuTriggerFor]="pagesMenu">
            <span class="fs-small fw-700">{{ postFilters.page }}</span>
          </button>
          <mat-menu #pagesMenu>
            <button mat-menu-item *ngFor="let page of (pageInfo?.maxPage ?? 1)|fillArray" (click)="doSearch(page)">
              {{ page }}
            </button>
          </mat-menu>
          <button class="circle-button" (click)="nextPage()" [disabled]="!pageInfo?.next || isLoading">
            <mat-icon class="small-icon">navigate_next</mat-icon>
          </button>
        </div>
      </div>
    </div>

    <!-- Post grid -->
    <section class="posts-grid">
      <div class="rounded-card flex-column flex-space_between gap-1" *ngFor="let post of posts">
        <div class="flex-space_between-center">
          <p>{{ post.user.fullName }} - {{ post.createdAt|timeAgo }}</p>
          <mat-icon class="text-blue-dark">more_vert</mat-icon>
        </div>
  
        <div>
          <h2>{{ post.title }}</h2>
          <p>{{ post.shortDescription }}</p>
        </div>
  
        <div class="flex-space_between-center flex-wrap gap-025">
          <div class="flex-center-center gap-025">
            <mat-icon class="text-blue-dark">description</mat-icon>
            <span class="fw-600">{{ post.totalFiles }} Documentos</span>
          </div>
  
          <div class="flex-wrap gap-025">
            <span class="small-border-tag-{{ post.mainFile.tagColor }}">{{ post.mainFile.ext }}</span>
            <ng-container *ngFor="let file of post.suportingMaterial">
              <span class="small-border-tag-{{ file.tagColor }}">{{ file.ext }}</span>
            </ng-container>
          </div>
        </div>
  
        <div class="flex-wrap gap-025">
          <span class="rounded-button-slim bg-text-academic-level">Nivel académico: {{ post.academicLevel.name }}</span>
          <span class="rounded-button-slim bg-text-axis">Eje: {{ post.axis.name }}</span>
          <span class="rounded-button-slim bg-text-subject">Asignatura: {{ post.axis.subject.name }}</span>
        </div>
  
        <div class="flex-space_between-center">
          <div class="flex-center-center gap-1">
            <div class="flex-center-center gap-025">
              <mat-icon class="small-icon text-blue-dark">favorite_outline</mat-icon>
              <span class="fw-600">{{ post.totalLikes }} Me gusta</span>
            </div>
            <div class="flex-center-center gap-025">
              <mat-icon class="small-icon text-blue-dark">visibility</mat-icon>
              <span class="fw-600">{{ post.totalLikes }} Visualizaciones</span>
            </div>
          </div>
  
          <mat-icon class="text-red">
            {{ post.alreadyLiked ? 'favorite' : 'favorite_outline' }}
          </mat-icon>
        </div>
      </div>
    </section>
  </div>
</main>
